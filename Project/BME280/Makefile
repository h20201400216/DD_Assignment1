# All the Parameters can be over-ridden while Make call from the Terminal. Default values are assigned to match with the currnet project files.

# Note: The make recepies are designed in such a way assuming the make invoke is done from superuser(root)

# Name of the Userapp file.
USERFILE ?= userapp

# Name of the Kernel File
KERN_NAME ?= bme280

# Name of the Data Log file used for storing sensor values
DATAFILE ?= data.log

# Default Text Editor for displaying the log file
TEXT_EDITOR ?= nano

# Kernel Module Name Definition
obj-m := $(KERN_NAME).o
 
# Compiles the Kernel and Userapp files
all:
	make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) modules
	gcc -o $(USERFILE) $(USERFILE).c

# Compiles the Kernel code alone
kern:
	make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) modules

# Compiles the Userapp alone
user:
	gcc -o $(USERFILE) $(USERFILE).c
 
# Cleans the directory (Won't remove the log file)
clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) clean
	rm userapp

# Installs the Compiled Kernel Module into Kernel Space
install:
	sudo insmod $(KERN_NAME).ko

# Removes the loaded module from the Kernel Space
remove:
	sudo rmmod $(KERN_NAME).ko

# Runs the Userapp Application
run:
	sudo ./$(USERFILE)

# Deletes the Sensor Log generated by Userapp application
log_clean:
	rm $(DATAFILE)

# Displays the Log generated by the Userapp application
log_display:
	nano $(DATAFILE)
